<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% block title %}Roleplay Circles{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¯</text></svg>">
    <meta name="theme-color" content="#0f1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    {% block head %}{% endblock %}
</head>
<body>
    {% block nav %}{% endblock %}

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="container" style="padding-top: 12px;">
        {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% block body %}{% endblock %}

    <div class="toast-container" id="toasts"></div>

    <script>
    function showToast(msg, type = 'success') {
        const container = document.getElementById('toasts');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = msg;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    async function api(url, options = {}) {
        const defaults = {
            headers: { 'Content-Type': 'application/json' },
        };
        if (options.body && typeof options.body === 'object') {
            options.body = JSON.stringify(options.body);
        }
        const resp = await fetch(url, { ...defaults, ...options });
        const data = await resp.json();
        if (!resp.ok) {
            throw new Error(data.error || 'Request failed');
        }
        return data;
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('Copied to clipboard!');
        }).catch(() => {
            // Fallback
            const ta = document.createElement('textarea');
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            ta.remove();
            showToast('Copied!');
        });
    }

    function timeAgo(dateStr) {
        const d = new Date(dateStr);
        const now = new Date();
        const seconds = Math.floor((now - d) / 1000);
        if (seconds < 60) return 'just now';
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        return `${days}d ago`;
    }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
