<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join {{ circle.name }} - Roleplay Circles</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="widget centered">
        <header>
            <h1>ðŸŽ¯ Roleplay Circles</h1>
        </header>
        
        <div class="join-header">
            <h2>Join "{{ circle.name }}"</h2>
            <p class="member-count">{{ circle.members|length }} member{% if circle.members|length != 1 %}s{% endif %} already in</p>
        </div>
        
        <div class="join-form">
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="userName" placeholder="e.g. Mike">
            </div>
            
            <div class="form-group">
                <label>Your Zoom Link (optional)</label>
                <input type="text" id="zoomLink" placeholder="https://zoom.us/j/...">
            </div>
            
            <button class="btn btn-join-circle" onclick="joinCircle()">Join Circle</button>
        </div>
        
        <div class="existing-members">
            <p>Already a member?</p>
            <select id="existingMember" onchange="goToMember()">
                <option value="">Select your name...</option>
                {% for member in circle.members %}
                <option value="{{ member.id }}">{{ member.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <script>
        const circleCode = '{{ code }}';
        
        async function joinCircle() {
            const name = document.getElementById('userName').value.trim();
            const zoomLink = document.getElementById('zoomLink').value.trim();
            
            if (!name) {
                alert('Please enter your name');
                return;
            }
            
            try {
                const response = await fetch(`/join/${circleCode}/submit`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name, zoom_link: zoomLink })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = data.redirect;
                } else {
                    alert(data.error || 'Failed to join');
                }
            } catch (err) {
                console.error(err);
                alert('Error joining circle');
            }
        }
        
        function goToMember() {
            const memberId = document.getElementById('existingMember').value;
            if (memberId) {
                window.location.href = `/c/${circleCode}?user=${memberId}`;
            }
        }
    </script>
</body>
</html>
